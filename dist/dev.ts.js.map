{"version":3,"file":"dev.ts.js","sources":["src/cli/dev.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as net from 'net';\nimport * as clorox from 'clorox';\nimport * as child_process from 'child_process';\nimport * as http from 'http';\nimport mkdirp from 'mkdirp';\nimport rimraf from 'rimraf';\nimport format_messages from 'webpack-format-messages';\nimport prettyMs from 'pretty-ms';\nimport * as ports from 'port-authority';\nimport { locations } from '../config';\nimport { create_compilers, create_main_manifests, create_routes, create_serviceworker_manifest } from '../core';\n\ntype Deferred = {\n\tpromise?: Promise<any>;\n\tfulfil?: (value?: any) => void;\n\treject?: (err: Error) => void;\n}\n\nfunction deferred() {\n\tconst d: Deferred = {};\n\n\td.promise = new Promise((fulfil, reject) => {\n\t\td.fulfil = fulfil;\n\t\td.reject = reject;\n\t});\n\n\treturn d;\n}\n\nfunction create_hot_update_server(port: number, interval = 10000) {\n\tconst clients = new Set();\n\n\tconst server = http.createServer((req, res) => {\n\t\tif (req.url !== '/__sapper__') return;\n\n\t\treq.socket.setKeepAlive(true);\n\t\tres.writeHead(200, {\n\t\t\t'Access-Control-Allow-Origin': '*',\n\t\t\t'Access-Control-Allow-Headers': 'Cache-Control',\n\t\t\t'Content-Type': 'text/event-stream;charset=utf-8',\n\t\t\t'Cache-Control': 'no-cache, no-transform',\n\t\t\t'Connection': 'keep-alive',\n\t\t\t// While behind nginx, event stream should not be buffered:\n\t\t\t// http://nginx.org/docs/http/ngx_http_proxy_module.html#proxy_buffering\n\t\t\t'X-Accel-Buffering': 'no'\n\t\t});\n\n\t\tres.write('\\n');\n\n\t\tclients.add(res);\n\t\treq.on('close', () => {\n\t\t\tclients.delete(res);\n\t\t});\n\t});\n\n\tserver.listen(port);\n\n\tfunction send(data: any) {\n\t\tclients.forEach(client => {\n\t\t\tclient.write(`data: ${JSON.stringify(data)}\\n\\n`);\n\t\t});\n\t}\n\n\tsetInterval(() => {\n\t\tsend(null)\n\t}, interval);\n\n\treturn { send };\n}\n\nexport async function dev(opts: { port: number, open: boolean }) {\n\tprocess.env.NODE_ENV = 'development';\n\n\tlet port = opts.port || +process.env.PORT;\n\n\tif (port) {\n\t\tif (!await ports.check(port)) {\n\t\t\tconsole.log(`${clorox.bold.red(`> Port ${port} is unavailable`)}`);\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\tport = await ports.find(3000);\n\t}\n\n\tconst dir = locations.dest();\n\trimraf.sync(dir);\n\tmkdirp.sync(dir);\n\n\tconst dev_port = await ports.find(10000);\n\n\tconst routes = create_routes();\n\tcreate_main_manifests({ routes, dev_port });\n\n\tconst hot_update_server = create_hot_update_server(dev_port);\n\n\twatch_files(`${locations.routes()}/**/*`, ['add', 'unlink'], () => {\n\t\tconst routes = create_routes();\n\t\tcreate_main_manifests({ routes, dev_port });\n\t});\n\n\twatch_files(`${locations.app()}/template.html`, ['change'], () => {\n\t\thot_update_server.send({\n\t\t\taction: 'reload'\n\t\t});\n\t});\n\n\tlet proc: child_process.ChildProcess;\n\n\tprocess.on('exit', () => {\n\t\t// sometimes webpack crashes, so we need to kill our children\n\t\tif (proc) proc.kill();\n\t});\n\n\tconst deferreds = {\n\t\tserver: deferred(),\n\t\tclient: deferred()\n\t};\n\n\tlet restarting = false;\n\tlet build = {\n\t\tunique_warnings: new Set(),\n\t\tunique_errors: new Set()\n\t};\n\n\tfunction restart_build(filename: string) {\n\t\tif (restarting) return;\n\n\t\trestarting = true;\n\t\tbuild = {\n\t\t\tunique_warnings: new Set(),\n\t\t\tunique_errors: new Set()\n\t\t};\n\n\t\tprocess.nextTick(() => {\n\t\t\trestarting = false;\n\t\t});\n\n\t\tconsole.log(`\\n${clorox.bold.cyan(path.relative(process.cwd(), filename))} changed. rebuilding...`);\n\t}\n\n\t// TODO watch the configs themselves?\n\tconst compilers = create_compilers();\n\n\tfunction watch(compiler: any, { name, invalid = noop, error = noop, result }: {\n\t\tname: string,\n\t\tinvalid?: (filename: string) => void;\n\t\terror?: (error: Error) => void;\n\t\tresult: (stats: any) => void;\n\t}) {\n\t\tcompiler.hooks.invalid.tap('sapper', (filename: string) => {\n\t\t\tinvalid(filename);\n\t\t});\n\n\t\tcompiler.watch({}, (err: Error, stats: any) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(`${clorox.red(`✗ ${name}`)}`);\n\t\t\t\tconsole.log(`${clorox.red(err.message)}`);\n\t\t\t\terror(err);\n\t\t\t} else {\n\t\t\t\tconst messages = format_messages(stats);\n\t\t\t\tconst info = stats.toJson();\n\n\t\t\t\tif (messages.errors.length > 0) {\n\t\t\t\t\tconsole.log(`${clorox.bold.red(`✗ ${name}`)}`);\n\n\t\t\t\t\tconst filtered = messages.errors.filter((message: string) => {\n\t\t\t\t\t\treturn !build.unique_errors.has(message);\n\t\t\t\t\t});\n\n\t\t\t\t\tfiltered.forEach((message: string) => {\n\t\t\t\t\t\tbuild.unique_errors.add(message);\n\t\t\t\t\t\tconsole.log(message);\n\t\t\t\t\t});\n\n\t\t\t\t\tconst hidden = messages.errors.length - filtered.length;\n\t\t\t\t\tif (hidden > 0) {\n\t\t\t\t\t\tconsole.log(`${hidden} duplicate ${hidden === 1 ? 'error' : 'errors'} hidden\\n`);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (messages.warnings.length > 0) {\n\t\t\t\t\t\tconsole.log(`${clorox.bold.yellow(`• ${name}`)}`);\n\n\t\t\t\t\t\tconst filtered = messages.warnings.filter((message: string) => {\n\t\t\t\t\t\t\treturn !build.unique_warnings.has(message);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tfiltered.forEach((message: string) => {\n\t\t\t\t\t\t\tbuild.unique_warnings.add(message);\n\t\t\t\t\t\t\tconsole.log(`${message}\\n`);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst hidden = messages.warnings.length - filtered.length;\n\t\t\t\t\t\tif (hidden > 0) {\n\t\t\t\t\t\t\tconsole.log(`${hidden} duplicate ${hidden === 1 ? 'warning' : 'warnings'} hidden\\n`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log(`${clorox.bold.green(`✔ ${name}`)} ${clorox.gray(`(${prettyMs(info.time)})`)}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tresult(info);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\twatch(compilers.server, {\n\t\tname: 'server',\n\n\t\tinvalid: filename => {\n\t\t\trestart_build(filename);\n\t\t\t// TODO print message\n\t\t\tdeferreds.server = deferred();\n\t\t},\n\n\t\tresult: info => {\n\t\t\t// TODO log compile errors/warnings\n\n\t\t\tfs.writeFileSync(path.join(dir, 'server_info.json'), JSON.stringify(info, null, '  '));\n\n\t\t\tdeferreds.client.promise.then(() => {\n\t\t\t\tfunction restart() {\n\t\t\t\t\tports.wait(port).then(deferreds.server.fulfil);\n\t\t\t\t}\n\n\t\t\t\tif (proc) {\n\t\t\t\t\tproc.kill();\n\t\t\t\t\tproc.on('exit', restart);\n\t\t\t\t} else {\n\t\t\t\t\trestart();\n\t\t\t\t}\n\n\t\t\t\tproc = child_process.fork(`${dir}/server.js`, [], {\n\t\t\t\t\tcwd: process.cwd(),\n\t\t\t\t\tenv: Object.assign({\n\t\t\t\t\t\tPORT: port\n\t\t\t\t\t}, process.env)\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\tlet first = true;\n\n\twatch(compilers.client, {\n\t\tname: 'client',\n\n\t\tinvalid: filename => {\n\t\t\trestart_build(filename);\n\t\t\tdeferreds.client = deferred();\n\n\t\t\t// TODO we should delete old assets. due to a webpack bug\n\t\t\t// i don't even begin to comprehend, this is apparently\n\t\t\t// quite difficult\n\t\t},\n\n\t\tresult: info => {\n\t\t\tfs.writeFileSync(path.join(dir, 'client_info.json'), JSON.stringify(info, null, '  '));\n\t\t\tdeferreds.client.fulfil();\n\n\t\t\tconst client_files = info.assets.map((chunk: { name: string }) => `client/${chunk.name}`);\n\n\t\t\tdeferreds.server.promise.then(() => {\n\t\t\t\thot_update_server.send({\n\t\t\t\t\tstatus: 'completed'\n\t\t\t\t});\n\n\t\t\t\tif (first) {\n\t\t\t\t\tfirst = false;\n\t\t\t\t\tconsole.log(`${clorox.bold.cyan(`> Listening on http://localhost:${port}`)}`);\n\t\t\t\t\tif (opts.open) child_process.exec(`open http://localhost:${port}`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tcreate_serviceworker_manifest({\n\t\t\t\troutes: create_routes(),\n\t\t\t\tclient_files\n\t\t\t});\n\n\t\t\twatch_serviceworker();\n\t\t}\n\t});\n\n\tlet watch_serviceworker = compilers.serviceworker\n\t\t? function() {\n\t\t\twatch_serviceworker = noop;\n\n\t\t\twatch(compilers.serviceworker, {\n\t\t\t\tname: 'service worker',\n\n\t\t\t\tresult: info => {\n\t\t\t\t\tfs.writeFileSync(path.join(dir, 'serviceworker_info.json'), JSON.stringify(info, null, '  '));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t: noop;\n}\n\nfunction noop() {}\n\nfunction watch_files(pattern: string, events: string[], callback: () => void) {\n\tconst chokidar = require('chokidar');\n\n\tconst watcher = chokidar.watch(pattern, {\n\t\tpersistent: true,\n\t\tignoreInitial: true\n\t});\n\n\tevents.forEach(event => {\n\t\twatcher.on(event, callback);\n\t});\n}\n"],"names":["http.createServer","clorox.bold","path.relative","clorox.red","clorox.gray","ports.check","ports.find","locations","create_routes","create_main_manifests","create_compilers","fs.writeFileSync","path.join","ports.wait","child_process.fork","child_process.exec","create_serviceworker_manifest"],"mappings":"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"}