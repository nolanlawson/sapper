{"version":3,"file":"start.ts.js","sources":["src/cli/start.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport * as child_process from 'child_process';\nimport * as clorox from 'clorox';\nimport * as ports from 'port-authority';\n\nexport async function start(dir: string, opts: { port: number, open: boolean }) {\n\tlet port = opts.port || +process.env.PORT;\n\n\tconst resolved = path.resolve(dir);\n\tconst server = path.resolve(dir, 'server.js');\n\n\tif (!fs.existsSync(server)) {\n\t\tconsole.log(clorox.bold.red(`> ${dir}/server.js does not exist â€” type ${clorox.bold.cyan(dir === 'build' ? `npx sapper build` : `npx sapper build ${dir}`)} to create it`));\n\t\treturn;\n\t}\n\n\tif (port) {\n\t\tif (!await ports.check(port)) {\n\t\t\tconsole.log(clorox.bold.red(`> Port ${port} is unavailable`));\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\tport = await ports.find(3000);\n\t}\n\n\tchild_process.fork(server, [], {\n\t\tcwd: process.cwd(),\n\t\tenv: Object.assign({\n\t\t\tNODE_ENV: 'production',\n\t\t\tPORT: port,\n\t\t\tSAPPER_DEST: dir\n\t\t}, process.env)\n\t});\n\n\tawait ports.wait(port);\n\tconsole.log(`${clorox.bold.cyan(`> Listening on http://localhost:${port}`)}`);\n\tif (opts.open) child_process.exec(`open http://localhost:${port}`);\n}"],"names":["path.resolve","fs.existsSync","clorox.bold","ports.check","ports.find","child_process.fork","ports.wait","child_process.exec"],"mappings":";;;;;;;;;;;;eAM4B,GAAW,EAAE,IAAqC;;;;;;oBACzE,IAAI,GAAG,IAAI,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;oBAEpC,QAAQ,GAAGA,YAAY,CAAC,GAAG,CAAC,CAAC;oBAC7B,MAAM,GAAGA,YAAY,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;oBAE9C,IAAI,CAACC,aAAa,CAAC,MAAM,CAAC,EAAE;wBAC3B,OAAO,CAAC,GAAG,CAACC,WAAW,CAAC,GAAG,CAAC,OAAK,GAAG,8CAAoCA,WAAW,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,GAAG,kBAAkB,GAAG,sBAAoB,GAAK,CAAC,kBAAe,CAAC,CAAC,CAAC;wBAC5K,sBAAO;qBACP;yBAEG,IAAI,EAAJ,wBAAI;oBACF,qBAAMC,WAAW,CAAC,IAAI,CAAC,EAAA;;oBAA5B,IAAI,EAAC,SAAuB,CAAA,EAAE;wBAC7B,OAAO,CAAC,GAAG,CAACD,WAAW,CAAC,GAAG,CAAC,YAAU,IAAI,oBAAiB,CAAC,CAAC,CAAC;wBAC9D,sBAAO;qBACP;;wBAEM,qBAAME,UAAU,CAAC,IAAI,CAAC,EAAA;;oBAA7B,IAAI,GAAG,SAAsB,CAAC;;;oBAG/BC,kBAAkB,CAAC,MAAM,EAAE,EAAE,EAAE;wBAC9B,GAAG,EAAE,OAAO,CAAC,GAAG,EAAE;wBAClB,GAAG,EAAE,MAAM,CAAC,MAAM,CAAC;4BAClB,QAAQ,EAAE,YAAY;4BACtB,IAAI,EAAE,IAAI;4BACV,WAAW,EAAE,GAAG;yBAChB,EAAE,OAAO,CAAC,GAAG,CAAC;qBACf,CAAC,CAAC;oBAEH,qBAAMC,UAAU,CAAC,IAAI,CAAC,EAAA;;oBAAtB,SAAsB,CAAC;oBACvB,OAAO,CAAC,GAAG,CAAC,KAAGJ,WAAW,CAAC,IAAI,CAAC,qCAAmC,IAAM,CAAG,CAAC,CAAC;oBAC9E,IAAI,IAAI,CAAC,IAAI;wBAAEK,kBAAkB,CAAC,2BAAyB,IAAM,CAAC,CAAC;;;;;CACnE;;;;"}