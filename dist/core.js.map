{"version":3,"file":"core.js","sources":["../src/core/create_manifests.ts","../node_modules/require-relative/index.js","../src/core/create_compilers/extract_css.ts","../src/core/create_compilers/RollupResult.ts","../src/core/create_compilers/RollupCompiler.ts","../node_modules/webpack-format-messages/index.js","../src/core/create_compilers/WebpackResult.ts","../src/core/create_compilers/WebpackCompiler.ts","../src/core/create_compilers/index.ts","../src/core/create_manifest_data.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { posixify, stringify, walk, write_if_changed } from '../utils';\nimport { Page, PageComponent, ManifestData } from '../interfaces';\n\nexport function create_main_manifests({\n\tbundler,\n\tmanifest_data,\n\tdev_port,\n\tdev,\n\tcwd,\n\tsrc,\n\tdest,\n\troutes,\n\toutput\n}: {\n\tbundler: string,\n\tmanifest_data: ManifestData;\n\tdev_port?: number;\n\tdev: boolean;\n\tcwd: string;\n\tsrc: string;\n\tdest: string;\n\troutes: string;\n\toutput: string\n}) {\n\tif (!fs.existsSync(output)) fs.mkdirSync(output);\n\n\tconst path_to_routes = path.relative(output, routes);\n\n\tconst client_manifest = generate_client(manifest_data, path_to_routes, bundler, dev, dev_port);\n\tconst server_manifest = generate_server(manifest_data, path_to_routes, cwd, src, dest, dev);\n\n\twrite_if_changed(\n\t\t`${output}/_layout.html`,\n\t\t`<svelte:component this={child.component} {...child.props}/>`\n\t);\n\twrite_if_changed(`${output}/client.js`, client_manifest);\n\twrite_if_changed(`${output}/server.js`, server_manifest);\n}\n\nexport function create_serviceworker_manifest({ manifest_data, output, client_files, static_files }: {\n\tmanifest_data: ManifestData;\n\toutput: string;\n\tclient_files: string[];\n\tstatic_files: string;\n}) {\n\tlet files: string[] = ['/service-worker-index.html'];\n\n\tif (fs.existsSync(static_files)) {\n\t\tfiles = files.concat(walk(static_files));\n\t} else {\n\t\t// TODO remove in a future version\n\t\tif (fs.existsSync('assets')) {\n\t\t\tthrow new Error(`As of Sapper 0.21, the assets/ directory should become static/`);\n\t\t}\n\t}\n\n\tlet code = `\n\t\t// This file is generated by Sapper — do not edit it!\n\t\texport const timestamp = ${Date.now()};\n\n\t\texport const files = [\\n\\t${files.map((x: string) => stringify(x)).join(',\\n\\t')}\\n];\n\t\texport { files as assets }; // legacy\n\n\t\texport const shell = [\\n\\t${client_files.map((x: string) => stringify(x)).join(',\\n\\t')}\\n];\n\n\t\texport const routes = [\\n\\t${manifest_data.pages.map((r: Page) => `{ pattern: ${r.pattern} }`).join(',\\n\\t')}\\n];\n\t`.replace(/^\\t\\t/gm, '').trim();\n\n\twrite_if_changed(`${output}/service-worker.js`, code);\n}\n\nfunction generate_client(\n\tmanifest_data: ManifestData,\n\tpath_to_routes: string,\n\tbundler: string,\n\tdev: boolean,\n\tdev_port?: number\n) {\n\tconst template_file = path.resolve(__dirname, '../templates/client.js');\n\tconst template = fs.readFileSync(template_file, 'utf-8');\n\n\tconst page_ids = new Set(manifest_data.pages.map(page =>\n\t\tpage.pattern.toString()));\n\n\tconst server_routes_to_ignore = manifest_data.server_routes.filter(route =>\n\t\t!page_ids.has(route.pattern.toString()));\n\n\tconst component_indexes: Record<string, number> = {};\n\n\tconst components = `[\n\t\t${manifest_data.components.map((component, i) => {\n\t\t\tconst annotation = bundler === 'webpack'\n\t\t\t\t? `/* webpackChunkName: \"${component.name}\" */ `\n\t\t\t\t: '';\n\n\t\t\tconst source = get_file(path_to_routes, component);\n\n\t\t\tcomponent_indexes[component.name] = i;\n\n\t\t\treturn `{\n\t\t\tjs: () => import(${annotation}${stringify(source)}),\n\t\t\tcss: \"__SAPPER_CSS_PLACEHOLDER:${stringify(component.file, false)}__\"\n\t\t}`;\n\t\t}).join(',\\n\\t\\t')}\n\t]`.replace(/^\\t/gm, '').trim();\n\n\tlet needs_decode = false;\n\n\tlet pages = `[\n\t\t${manifest_data.pages.map(page => `{\n\t\t\t// ${page.parts[page.parts.length - 1].component.file}\n\t\t\tpattern: ${page.pattern},\n\t\t\tparts: [\n\t\t\t\t${page.parts.map(part => {\n\t\t\t\t\tif (part === null) return 'null';\n\n\t\t\t\t\tif (part.params.length > 0) {\n\t\t\t\t\t\tneeds_decode = true;\n\t\t\t\t\t\tconst props = part.params.map((param, i) => `${param}: d(match[${i + 1}])`);\n\t\t\t\t\t\treturn `{ i: ${component_indexes[part.component.name]}, params: match => ({ ${props.join(', ')} }) }`;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn `{ i: ${component_indexes[part.component.name]} }`;\n\t\t\t\t}).join(',\\n\\t\\t\\t\\t')}\n\t\t\t]\n\t\t}`).join(',\\n\\n\\t\\t')}\n\t]`.replace(/^\\t/gm, '').trim();\n\n\tif (needs_decode) {\n\t\tpages = `(d => ${pages})(decodeURIComponent)`\n\t}\n\n\tlet footer = '';\n\n\tif (dev) {\n\t\tconst sapper_dev_client = posixify(\n\t\t\tpath.resolve(__dirname, '../sapper-dev-client.js')\n\t\t);\n\n\t\tfooter = `\n\n\t\t\tif (typeof window !== 'undefined') {\n\t\t\t\timport(${stringify(sapper_dev_client)}).then(client => {\n\t\t\t\t\tclient.connect(${dev_port});\n\t\t\t\t});\n\t\t\t}`.replace(/^\\t{3}/gm, '');\n\t}\n\n\treturn `// This file is generated by Sapper — do not edit it!\\n` + template\n\t\t.replace('__ROOT__', stringify(get_file(path_to_routes, manifest_data.root), false))\n\t\t.replace('__ERROR__', stringify(posixify(`${path_to_routes}/_error.html`), false))\n\t\t.replace('__IGNORE__', `[${server_routes_to_ignore.map(route => route.pattern).join(', ')}]`)\n\t\t.replace('__COMPONENTS__', components)\n\t\t.replace('__PAGES__', pages) +\n\t\tfooter;\n}\n\nfunction generate_server(\n\tmanifest_data: ManifestData,\n\tpath_to_routes: string,\n\tcwd: string,\n\tsrc: string,\n\tdest: string,\n\tdev: boolean\n) {\n\tconst template_file = path.resolve(__dirname, '../templates/server.js');\n\tconst template = fs.readFileSync(template_file, 'utf-8');\n\n\tconst imports = [].concat(\n\t\tmanifest_data.server_routes.map(route =>\n\t\t\t`import * as __${route.name} from ${stringify(posixify(`${path_to_routes}/${route.file}`))};`),\n\t\tmanifest_data.components.map(component =>\n\t\t\t`import __${component.name} from ${stringify(get_file(path_to_routes, component))};`),\n\t\t`import root from ${stringify(get_file(path_to_routes, manifest_data.root))};`,\n\t\t`import error from ${stringify(posixify(`${path_to_routes}/_error.html`))};`\n\t);\n\n\tlet code = `\n\t\t${imports.join('\\n')}\n\n\t\tconst d = decodeURIComponent;\n\n\t\texport const manifest = {\n\t\t\tserver_routes: [\n\t\t\t\t${manifest_data.server_routes.map(route => `{\n\t\t\t\t\t// ${route.file}\n\t\t\t\t\tpattern: ${route.pattern},\n\t\t\t\t\thandlers: __${route.name},\n\t\t\t\t\tparams: ${route.params.length > 0\n\t\t\t\t\t\t? `match => ({ ${route.params.map((param, i) => `${param}: d(match[${i + 1}])`).join(', ')} })`\n\t\t\t\t\t\t: `() => ({})`}\n\t\t\t\t}`).join(',\\n\\n\\t\\t\\t\\t')}\n\t\t\t],\n\n\t\t\tpages: [\n\t\t\t\t${manifest_data.pages.map(page => `{\n\t\t\t\t\t// ${page.parts[page.parts.length - 1].component.file}\n\t\t\t\t\tpattern: ${page.pattern},\n\t\t\t\t\tparts: [\n\t\t\t\t\t\t${page.parts.map(part => {\n\t\t\t\t\t\t\tif (part === null) return 'null';\n\n\t\t\t\t\t\t\tconst props = [\n\t\t\t\t\t\t\t\t`name: \"${part.component.name}\"`,\n\t\t\t\t\t\t\t\t`file: ${stringify(part.component.file)}`,\n\t\t\t\t\t\t\t\t`component: __${part.component.name}`\n\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\tif (part.params.length > 0) {\n\t\t\t\t\t\t\t\tconst params = part.params.map((param, i) => `${param}: d(match[${i + 1}])`);\n\t\t\t\t\t\t\t\tprops.push(`params: match => ({ ${params.join(', ')} })`);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn `{ ${props.join(', ')} }`;\n\t\t\t\t\t\t}).join(',\\n\\t\\t\\t\\t\\t\\t')}\n\t\t\t\t\t]\n\t\t\t\t}`).join(',\\n\\n\\t\\t\\t\\t')}\n\t\t\t],\n\n\t\t\troot,\n\n\t\t\terror\n\t\t};`.replace(/^\\t\\t/gm, '').trim();\n\n\tconst build_dir = posixify(path.relative(cwd, dest));\n\tconst src_dir = posixify(path.relative(cwd, src));\n\n\treturn `// This file is generated by Sapper — do not edit it!\\n` + template\n\t\t.replace('__BUILD__DIR__', JSON.stringify(build_dir))\n\t\t.replace('__SRC__DIR__', JSON.stringify(src_dir))\n\t\t.replace('__DEV__', dev ? 'true' : 'false')\n\t\t.replace(/const manifest = __MANIFEST__;/, code);\n}\n\nfunction get_file(path_to_routes: string, component: PageComponent) {\n\tif (component.default) {\n\t\treturn `./_layout.html`;\n\t}\n\n\treturn posixify(`${path_to_routes}/${component.file}`);\n}\n","/*\nrelative require\n*/'use strict';\n\nvar path = require('path');\nvar Module = require('module');\n\nvar modules = {};\n\nvar getModule = function(dir) {\n  var rootPath = dir ? path.resolve(dir) : process.cwd();\n  var rootName = path.join(rootPath, '@root');\n  var root = modules[rootName];\n  if (!root) {\n    root = new Module(rootName);\n    root.filename = rootName;\n    root.paths = Module._nodeModulePaths(rootPath);\n    modules[rootName] = root;\n  }\n  return root;\n};\n\nvar requireRelative = function(requested, relativeTo) {\n  var root = getModule(relativeTo);\n  return root.require(requested);\n};\n\nrequireRelative.resolve = function(requested, relativeTo) {\n  var root = getModule(relativeTo);\n  return Module._resolveFilename(requested, root);\n};\n\nmodule.exports = requireRelative;\n","import * as fs from 'fs';\nimport * as path from 'path';\nimport hash from 'string-hash';\nimport * as codec from 'sourcemap-codec';\nimport { PageComponent, Dirs } from '../../interfaces';\nimport { CompileResult, Chunk } from './interfaces';\nimport { posixify } from '../../utils'\n\nconst inline_sourcemap_header = 'data:application/json;charset=utf-8;base64,';\n\nfunction extract_sourcemap(raw: string, id: string) {\n\tlet raw_map: string;\n\tlet map = null;\n\n\tconst code = raw.replace(/\\/\\*#\\s+sourceMappingURL=(.+)\\s+\\*\\//g, (m, url) => {\n\t\tif (raw_map) {\n\t\t\t// TODO should not happen!\n\t\t\tthrow new Error(`Found multiple sourcemaps in single CSS file (${id})`);\n\t\t}\n\n\t\traw_map = url;\n\t\treturn '';\n\t}).trim();\n\n\tif (raw_map) {\n\t\tif (raw_map.startsWith(inline_sourcemap_header)) {\n\t\t\tconst json = Buffer.from(raw_map.slice(inline_sourcemap_header.length), 'base64').toString();\n\t\t\tmap = JSON.parse(json);\n\t\t} else {\n\t\t\t// TODO do we want to handle non-inline sourcemaps? could be a rabbit hole\n\t\t}\n\t}\n\n\treturn {\n\t\tcode,\n\t\tmap\n\t};\n}\n\ntype SourceMap = {\n\tversion: 3;\n\tfile: string;\n\tsources: string[];\n\tsourcesContent: string[];\n\tnames: string[];\n\tmappings: string;\n};\n\nfunction get_css_from_modules(modules: string[], css_map: Map<string, string>, dirs: Dirs) {\n\tconst parts: string[] = [];\n\tconst mappings: number[][][] = [];\n\n\tconst combined_map: SourceMap = {\n\t\tversion: 3,\n\t\tfile: null,\n\t\tsources: [],\n\t\tsourcesContent: [],\n\t\tnames: [],\n\t\tmappings: null\n\t};\n\n\tmodules.forEach(module => {\n\t\tif (!/\\.css$/.test(module)) return;\n\n\t\tconst css = css_map.get(module);\n\n\t\tconst { code, map } = extract_sourcemap(css, module);\n\n\t\tparts.push(code);\n\n\t\tif (map) {\n\t\t\tconst lines = codec.decode(map.mappings);\n\n\t\t\tif (combined_map.sources.length > 0 || combined_map.names.length > 0) {\n\t\t\t\tlines.forEach(line => {\n\t\t\t\t\tline.forEach(segment => {\n\t\t\t\t\t\t// adjust source index\n\t\t\t\t\t\tsegment[1] += combined_map.sources.length;\n\n\t\t\t\t\t\t// adjust name index\n\t\t\t\t\t\tif (segment[4]) segment[4] += combined_map.names.length;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tcombined_map.sources.push(...map.sources);\n\t\t\tcombined_map.sourcesContent.push(...map.sourcesContent);\n\t\t\tcombined_map.names.push(...map.names);\n\n\t\t\tmappings.push(...lines);\n\t\t}\n\t});\n\n\tif (parts.length > 0) {\n\t\tcombined_map.mappings = codec.encode(mappings);\n\n\t\tcombined_map.sources = combined_map.sources.map(source => path.relative(`${dirs.dest}/client`, source));\n\n\t\treturn {\n\t\t\tcode: parts.join('\\n'),\n\t\t\tmap: combined_map\n\t\t};\n\t}\n\n\treturn null;\n}\n\nexport default function extract_css(client_result: CompileResult, components: PageComponent[], dirs: Dirs) {\n\tconst result: {\n\t\tmain: string | null;\n\t\tchunks: Record<string, string[]>\n\t} = {\n\t\tmain: null,\n\t\tchunks: {}\n\t};\n\n\tif (!client_result.css_files) return; // Rollup-only for now\n\n\tlet asset_dir = `${dirs.dest}/client`;\n\tif (process.env.SAPPER_LEGACY_BUILD) asset_dir += '/legacy';\n\n\tconst unclaimed = new Set(client_result.css_files.map(x => x.id));\n\n\tconst lookup = new Map();\n\tclient_result.chunks.forEach(chunk => {\n\t\tlookup.set(chunk.file, chunk);\n\t});\n\n\tconst css_map = new Map();\n\tclient_result.css_files.forEach(css_module => {\n\t\tcss_map.set(css_module.id, css_module.code);\n\t});\n\n\tconst chunks_with_css = new Set();\n\n\t// concatenate and emit CSS\n\tclient_result.chunks.forEach(chunk => {\n\t\tconst css_modules = chunk.modules.filter(m => css_map.has(m));\n\t\tif (!css_modules.length) return;\n\n\t\tconst css = get_css_from_modules(css_modules, css_map, dirs);\n\n\t\tconst { code, map } = css;\n\n\t\tconst output_file_name = chunk.file.replace(/\\.js$/, '.css');\n\n\t\tmap.file = output_file_name;\n\t\tmap.sources = map.sources.map(source => path.relative(`${asset_dir}`, source));\n\n\t\tfs.writeFileSync(`${asset_dir}/${output_file_name}`, `${code}\\n/* sourceMappingURL=./${output_file_name}.map */`);\n\t\tfs.writeFileSync(`${asset_dir}/${output_file_name}.map`, JSON.stringify(map, null, '  '));\n\n\t\tchunks_with_css.add(chunk);\n\t});\n\n\tconst entry = path.resolve(dirs.src, 'client.js');\n\tconst entry_chunk = client_result.chunks.find(chunk => chunk.modules.indexOf(entry) !== -1);\n\n\tconst entry_chunk_dependencies: Set<Chunk> = new Set([entry_chunk]);\n\tconst entry_css_modules: string[] = [];\n\n\t// recursively find the chunks this component depends on\n\tentry_chunk_dependencies.forEach(chunk => {\n\t\tchunk.imports.forEach(file => {\n\t\t\tentry_chunk_dependencies.add(lookup.get(file));\n\t\t});\n\n\t\tif (chunks_with_css.has(chunk)) {\n\t\t\tchunk.modules.forEach(file => {\n\t\t\t\tunclaimed.delete(file);\n\t\t\t\tif (css_map.has(file)) {\n\t\t\t\t\tentry_css_modules.push(file);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\t// figure out which (css-having) chunks each component depends on\n\tcomponents.forEach(component => {\n\t\tconst resolved = path.resolve(dirs.routes, component.file);\n\t\tconst chunk: Chunk = client_result.chunks.find(chunk => chunk.modules.indexOf(resolved) !== -1);\n\n\t\tif (!chunk) {\n\t\t\t// this should never happen!\n\t\t\tthrow new Error(`Could not find chunk that owns ${component.file}`);\n\t\t}\n\n\t\tconst chunk_dependencies: Set<Chunk> = new Set([chunk]);\n\t\tconst css_dependencies: string[] = [];\n\n\t\t// recursively find the chunks this component depends on\n\t\tchunk_dependencies.forEach(chunk => {\n\t\t\tchunk.imports.forEach(file => {\n\t\t\t\tchunk_dependencies.add(lookup.get(file));\n\t\t\t});\n\n\t\t\tif (chunks_with_css.has(chunk)) {\n\t\t\t\tcss_dependencies.push(chunk.file.replace(/\\.js$/, '.css'));\n\n\t\t\t\tchunk.modules.forEach(file => {\n\t\t\t\t\tunclaimed.delete(file);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tresult.chunks[component.file] = css_dependencies;\n\t});\n\n\tfs.readdirSync(asset_dir).forEach(file => {\n\t\tif (fs.statSync(`${asset_dir}/${file}`).isDirectory()) return;\n\n\t\tconst source = fs.readFileSync(`${asset_dir}/${file}`, 'utf-8');\n\n\t\tconst replaced = source.replace(/[\"']__SAPPER_CSS_PLACEHOLDER:(.+?)__[\"']/g, (m, route) => {\n\t\t\treturn JSON.stringify(result.chunks[route]);\n\t\t});\n\n\t\tfs.writeFileSync(`${asset_dir}/${file}`, replaced);\n\t});\n\n\tunclaimed.forEach(file => {\n\t\tentry_css_modules.push(file);\n\t});\n\n\tconst leftover = get_css_from_modules(entry_css_modules, css_map, dirs);\n\tif (leftover) {\n\t\tconst { code, map } = leftover;\n\n\t\tconst main_hash = hash(code);\n\n\t\tconst output_file_name = `main.${main_hash}.css`;\n\n\t\tmap.file = output_file_name;\n\t\tmap.sources = map.sources.map(source => path.relative(asset_dir, source));\n\n\t\tfs.writeFileSync(`${asset_dir}/${output_file_name}`, `${code}\\n/* sourceMappingURL=client/${output_file_name}.map */`);\n\t\tfs.writeFileSync(`${asset_dir}/${output_file_name}.map`, JSON.stringify(map, null, '  '));\n\n\t\tresult.main = output_file_name;\n\t}\n\n\treturn result;\n}","import * as path from 'path';\nimport colors from 'kleur';\nimport pb from 'pretty-bytes';\nimport RollupCompiler from './RollupCompiler';\nimport extract_css from './extract_css';\nimport { left_pad } from '../../utils';\nimport { CompileResult, BuildInfo, CompileError, Chunk, CssFile } from './interfaces';\nimport { ManifestData, Dirs } from '../../interfaces';\n\nexport default class RollupResult implements CompileResult {\n\tduration: number;\n\terrors: CompileError[];\n\twarnings: CompileError[];\n\tchunks: Chunk[];\n\tassets: Record<string, string>;\n\tcss_files: CssFile[];\n\tcss: {\n\t\tmain: string,\n\t\tchunks: Record<string, string[]>\n\t};\n\tsummary: string;\n\n\tconstructor(duration: number, compiler: RollupCompiler) {\n\t\tthis.duration = duration;\n\n\t\tthis.errors = compiler.errors.map(munge_warning_or_error);\n\t\tthis.warnings = compiler.warnings.map(munge_warning_or_error); // TODO emit this as they happen\n\n\t\tthis.chunks = compiler.chunks.map(chunk => ({\n\t\t\tfile: chunk.fileName,\n\t\t\timports: chunk.imports.filter(Boolean),\n\t\t\tmodules: Object.keys(chunk.modules)\n\t\t}));\n\n\t\tthis.css_files = compiler.css_files;\n\n\t\t// TODO populate this properly. We don't have named chunks, as in\n\t\t// webpack, but we can have a route -> [chunk] map or something\n\t\tthis.assets = {};\n\n\t\tif (typeof compiler.input === 'string') {\n\t\t\tcompiler.chunks.forEach(chunk => {\n\t\t\t\tif (compiler.input in chunk.modules) {\n\t\t\t\t\tthis.assets.main = chunk.fileName;\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfor (const name in compiler.input) {\n\t\t\t\tconst file = compiler.input[name];\n\t\t\t\tthis.assets[name] = compiler.chunks.find(chunk => file in chunk.modules).fileName;\n\t\t\t}\n\t\t}\n\n\t\tthis.summary = compiler.chunks.map(chunk => {\n\t\t\tconst size_color = chunk.code.length > 150000 ? colors.bold.red : chunk.code.length > 50000 ? colors.bold.yellow : colors.bold.white;\n\t\t\tconst size_label = left_pad(pb(chunk.code.length), 10);\n\n\t\t\tconst lines = [size_color(`${size_label} ${chunk.fileName}`)];\n\n\t\t\tconst deps = Object.keys(chunk.modules)\n\t\t\t\t.map(file => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfile: path.relative(process.cwd(), file),\n\t\t\t\t\t\tsize: chunk.modules[file].renderedLength\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t\t.filter(dep => dep.size > 0)\n\t\t\t\t.sort((a, b) => b.size - a.size);\n\n\t\t\tconst total_unminified = deps.reduce((t, d) => t + d.size, 0);\n\n\t\t\tdeps.forEach((dep, i) => {\n\t\t\t\tconst c = i === deps.length - 1 ? '└' : '│';\n\t\t\t\tlet line = `           ${c} ${dep.file}`;\n\n\t\t\t\tif (deps.length > 1) {\n\t\t\t\t\tconst p = (100 * dep.size / total_unminified).toFixed(1);\n\t\t\t\t\tline += ` (${p}%)`;\n\t\t\t\t}\n\n\t\t\t\tlines.push(colors.gray(line));\n\t\t\t});\n\n\t\t\treturn lines.join('\\n');\n\t\t}).join('\\n');\n\t}\n\n\tto_json(manifest_data: ManifestData, dirs: Dirs): BuildInfo {\n\t\t// TODO extract_css has side-effects that don't belong\n\t\t// in a method called to_json\n\t\treturn {\n\t\t\tbundler: 'rollup',\n\t\t\tshimport: require('shimport/package.json').version,\n\t\t\tassets: this.assets,\n\t\t\tcss: extract_css(this, manifest_data.components, dirs)\n\t\t};\n\t}\n\n\tprint() {\n\t\tconst blocks: string[] = this.warnings.map(warning => {\n\t\t\treturn warning.file\n\t\t\t\t? `> ${colors.bold(warning.file)}\\n${warning.message}`\n\t\t\t\t: `> ${warning.message}`;\n\t\t});\n\n\t\tblocks.push(this.summary);\n\n\t\treturn blocks.join('\\n\\n');\n\t}\n}\n\nfunction munge_warning_or_error(warning_or_error: any) {\n\treturn {\n\t\tfile: warning_or_error.filename,\n\t\tmessage: [warning_or_error.message, warning_or_error.frame].filter(Boolean).join('\\n')\n\t};\n}\n\n","import * as path from 'path';\nimport relative from 'require-relative';\nimport { CompileResult } from './interfaces';\nimport RollupResult from './RollupResult';\n\nlet rollup: any;\n\nexport default class RollupCompiler {\n\t_: Promise<any>;\n\t_oninvalid: (filename: string) => void;\n\t_start: number;\n\tinput: string;\n\twarnings: any[];\n\terrors: any[];\n\tchunks: any[];\n\tcss_files: Array<{ id: string, code: string }>;\n\n\tconstructor(config: any) {\n\t\tthis._ = this.get_config(config);\n\t\tthis.input = null;\n\t\tthis.warnings = [];\n\t\tthis.errors = [];\n\t\tthis.chunks = [];\n\t\tthis.css_files = [];\n\t}\n\n\tasync get_config(mod: any) {\n\t\t// TODO this is hacky, and doesn't need to apply to all three compilers\n\t\t(mod.plugins || (mod.plugins = [])).push({\n\t\t\tname: 'sapper-internal',\n\t\t\toptions: (opts: any) => {\n\t\t\t\tthis.input = opts.input;\n\t\t\t},\n\t\t\trenderChunk: (code: string, chunk: any) => {\n\t\t\t\tthis.chunks.push(chunk);\n\t\t\t},\n\t\t\ttransform: (code: string, id: string) => {\n\t\t\t\tif (/\\.css$/.test(id)) {\n\t\t\t\t\tthis.css_files.push({ id, code });\n\t\t\t\t\treturn ``;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst onwarn = mod.onwarn || ((warning: any, handler: (warning: any) => void) => {\n\t\t\thandler(warning);\n\t\t});\n\n\t\tmod.onwarn = (warning: any) => {\n\t\t\tonwarn(warning, (warning: any) => {\n\t\t\t\tthis.warnings.push(warning);\n\t\t\t});\n\t\t};\n\n\t\treturn mod;\n\t}\n\n\toninvalid(cb: (filename: string) => void) {\n\t\tthis._oninvalid = cb;\n\t}\n\n\tasync compile(): Promise<CompileResult> {\n\t\tconst config = await this._;\n\n\t\tconst start = Date.now();\n\n\t\ttry {\n\t\t\tconst bundle = await rollup.rollup(config);\n\t\t\tawait bundle.write(config.output);\n\n\t\t\treturn new RollupResult(Date.now() - start, this);\n\t\t} catch (err) {\n\t\t\tif (err.filename) {\n\t\t\t\t// TODO this is a bit messy. Also, can\n\t\t\t\t// Rollup emit other kinds of error?\n\t\t\t\terr.message = [\n\t\t\t\t\t`Failed to build — error in ${err.filename}: ${err.message}`,\n\t\t\t\t\terr.frame\n\t\t\t\t].filter(Boolean).join('\\n');\n\t\t\t}\n\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tasync watch(cb: (err?: Error, stats?: any) => void) {\n\t\tconst config = await this._;\n\n\t\tconst watcher = rollup.watch(config);\n\n\t\twatcher.on('change', (id: string) => {\n\t\t\tthis.chunks = [];\n\t\t\tthis.warnings = [];\n\t\t\tthis.errors = [];\n\t\t\tthis._oninvalid(id);\n\t\t});\n\n\t\twatcher.on('event', (event: any) => {\n\t\t\tswitch (event.code) {\n\t\t\t\tcase 'FATAL':\n\t\t\t\t\t// TODO kill the process?\n\t\t\t\t\tif (event.error.filename) {\n\t\t\t\t\t\t// TODO this is a bit messy. Also, can\n\t\t\t\t\t\t// Rollup emit other kinds of error?\n\t\t\t\t\t\tevent.error.message = [\n\t\t\t\t\t\t\t`Failed to build — error in ${event.error.filename}: ${event.error.message}`,\n\t\t\t\t\t\t\tevent.error.frame\n\t\t\t\t\t\t].filter(Boolean).join('\\n');\n\t\t\t\t\t}\n\n\t\t\t\t\tcb(event.error);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ERROR':\n\t\t\t\t\tthis.errors.push(event.error);\n\t\t\t\t\tcb(null, new RollupResult(Date.now() - this._start, this));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'START':\n\t\t\t\tcase 'END':\n\t\t\t\t\t// TODO is there anything to do with this info?\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'BUNDLE_START':\n\t\t\t\t\tthis._start = Date.now();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'BUNDLE_END':\n\t\t\t\t\tcb(null, new RollupResult(Date.now() - this._start, this));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(`Unexpected event ${event.code}`);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic async load_config(cwd: string) {\n\t\tif (!rollup) rollup = relative('rollup', cwd);\n\n\t\tconst input = path.resolve(cwd, 'rollup.config.js');\n\n\t\tconst bundle = await rollup.rollup({\n\t\t\tinput,\n\t\t\tinlineDynamicImports: true,\n\t\t\texternal: (id: string) => {\n\t\t\t\treturn (id[0] !== '.' && !path.isAbsolute(id)) || id.slice(-5, id.length) === '.json';\n\t\t\t}\n\t\t});\n\n\t\tconst resp = await bundle.generate({ format: 'cjs' });\n\t\tconst { code } = resp.output ? resp.output[0] : resp;\n\n\t\t// temporarily override require\n\t\tconst defaultLoader = require.extensions['.js'];\n\t\trequire.extensions['.js'] = (module: any, filename: string) => {\n\t\t\tif (filename === input) {\n\t\t\t\tmodule._compile(code, filename);\n\t\t\t} else {\n\t\t\t\tdefaultLoader(module, filename);\n\t\t\t}\n\t\t};\n\n\t\tconst config: any = require(input);\n\t\tdelete require.cache[input];\n\n\t\treturn config;\n\t}\n}","/**\n * This has been adapted from `create-react-app`, authored by Facebook, Inc.\n * see: https://github.com/facebookincubator/create-react-app/tree/master/packages/react-dev-utils\n */\n\nconst { inverse } = require('kleur');\n\nconst errorLabel = 'Syntax error:';\nconst isLikelyASyntaxError = str => str.includes(errorLabel);\n\nconst exportRegex = /\\s*(.+?)\\s*(\")?export '(.+?)' was not found in '(.+?)'/;\nconst stackRegex = /^\\s*at\\s((?!webpack:).)*:\\d+:\\d+[\\s\\)]*(\\n|$)/gm;\n\nfunction formatMessage(message, isError) {\n  let lines = message.split('\\n');\n\n  if (lines.length > 2 && lines[1] === '') {\n    lines.splice(1, 1); // Remove extra newline.\n  }\n\n  // Remove loader notation from filenames:\n  //   `./~/css-loader!./src/App.css` ~~> `./src/App.css`\n  if (lines[0].lastIndexOf('!') !== -1) {\n    lines[0] = lines[0].substr(lines[0].lastIndexOf('!') + 1);\n  }\n\n\t// Remove useless `entry` filename stack details\n  lines = lines.filter(line => line.indexOf(' @ ') !== 0);\n\n  // 0 ~> filename; 1 ~> main err msg\n  if (!lines[0] || !lines[1]) {\n    return lines.join('\\n');\n  }\n\n  // Cleans up verbose \"module not found\" messages for files and packages.\n  if (lines[1].startsWith('Module not found: ')) {\n    lines = [\n      lines[0],\n      lines[1] // \"Module not found: \" is enough detail\n        .replace(\"Cannot resolve 'file' or 'directory' \", '')\n        .replace('Cannot resolve module ', '')\n        .replace('Error: ', '')\n        .replace('[CaseSensitivePathsPlugin] ', '')\n    ];\n  }\n\n  // Cleans up syntax error messages.\n  if (lines[1].startsWith('Module build failed: ')) {\n    lines[1] = lines[1].replace('Module build failed: SyntaxError:', errorLabel);\n  }\n\n  if (lines[1].match(exportRegex)) {\n    lines[1] = lines[1].replace(exportRegex, \"$1 '$4' does not contain an export named '$3'.\");\n  }\n\n  lines[0] = inverse(lines[0]);\n\n  // Reassemble & Strip internal tracing, except `webpack:` -- (create-react-app/pull/1050)\n  return lines.join('\\n').replace(stackRegex, '').trim();\n}\n\nmodule.exports = function (stats) {\n\tconst json = stats.toJson({}, true);\n\n\tconst result = {\n\t\terrors: json.errors.map(msg => formatMessage(msg, true)),\n\t\twarnings: json.warnings.map(msg => formatMessage(msg, false))\n\t};\n\n\t// Only show syntax errors if we have them\n  if (result.errors.some(isLikelyASyntaxError)) {\n    result.errors = result.errors.filter(isLikelyASyntaxError);\n  }\n\n  // First error is usually it; others usually the same\n  if (result.errors.length > 1) {\n    result.errors.length = 1;\n  }\n\n  return result;\n};\n\nmodule.exports.formatMessage = formatMessage;\n","import format_messages from 'webpack-format-messages';\nimport { CompileResult, BuildInfo, CompileError, Chunk, CssFile } from './interfaces';\nimport { ManifestData, Dirs } from '../../interfaces';\n\nconst locPattern = /\\((\\d+):(\\d+)\\)$/;\n\nfunction munge_warning_or_error(message: string) {\n\t// TODO this is all a bit rube goldberg...\n\tconst lines = message.split('\\n');\n\n\tconst file = lines.shift()\n\t\t.replace('\u001b[7m', '') // careful — there is a special character at the beginning of this string\n\t\t.replace('\u001b[27m', '')\n\t\t.replace('./', '');\n\n\tlet line = null;\n\tlet column = null;\n\n\tconst match = locPattern.exec(lines[0]);\n\tif (match) {\n\t\tlines[0] = lines[0].replace(locPattern, '');\n\t\tline = +match[1];\n\t\tcolumn = +match[2];\n\t}\n\n\treturn {\n\t\tfile,\n\t\tmessage: lines.join('\\n')\n\t};\n}\n\nexport default class WebpackResult implements CompileResult {\n\tduration: number;\n\terrors: CompileError[];\n\twarnings: CompileError[];\n\tchunks: Chunk[];\n\tassets: Record<string, string>;\n\tcss_files: CssFile[];\n\tstats: any;\n\n\tconstructor(stats: any) {\n\t\tthis.stats = stats;\n\n\t\tconst info = stats.toJson();\n\n\t\tconst messages = format_messages(stats);\n\n\t\tthis.errors = messages.errors.map(munge_warning_or_error);\n\t\tthis.warnings = messages.warnings.map(munge_warning_or_error);\n\n\t\tthis.duration = info.time;\n\n\t\tthis.chunks = info.assets.map((chunk: { name: string }) => ({ file: chunk.name }));\n\t\tthis.assets = info.assetsByChunkName;\n\t}\n\n\tto_json(manifest_data: ManifestData, dirs: Dirs): BuildInfo {\n\t\tconst extract_css = (assets: string[] | string) => {\n\t\t\tassets = Array.isArray(assets) ? assets : [assets];\n\t\t\treturn assets.find(asset => /\\.css$/.test(asset));\n\t\t};\n\n\t\treturn {\n\t\t\tbundler: 'webpack',\n\t\t\tshimport: null, // webpack has its own loader\n\t\t\tassets: this.assets,\n\t\t\tcss: {\n\t\t\t\tmain: extract_css(this.assets.main),\n\t\t\t\tchunks: Object\n\t\t\t\t\t.keys(this.assets)\n\t\t\t\t\t.filter(chunkName => chunkName !== 'main')\n\t\t\t\t\t.reduce((chunks: { [key: string]: string }, chukName) => {\n\t\t\t\t\t\tconst assets = this.assets[chukName];\n\t\t\t\t\t\tchunks[chukName] = extract_css(assets);\n\t\t\t\t\t\treturn chunks;\n\t\t\t\t\t}, {})\n\t\t\t}\n\t\t};\n\t}\n\n\tprint() {\n\t\treturn this.stats.toString({ colors: true });\n\t}\n}","import relative from 'require-relative';\nimport { CompileResult } from './interfaces';\nimport WebpackResult from './WebpackResult';\n\nlet webpack: any;\n\nexport class WebpackCompiler {\n\t_: any;\n\n\tconstructor(config: any) {\n\t\tif (!webpack) webpack = relative('webpack', process.cwd());\n\t\tthis._ = webpack(config);\n\t}\n\n\toninvalid(cb: (filename: string) => void) {\n\t\tthis._.hooks.invalid.tap('sapper', cb);\n\t}\n\n\tcompile(): Promise<CompileResult> {\n\t\treturn new Promise((fulfil, reject) => {\n\t\t\tthis._.run((err: Error, stats: any) => {\n\t\t\t\tif (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t\tprocess.exit(1);\n\t\t\t\t}\n\n\t\t\t\tconst result = new WebpackResult(stats);\n\n\t\t\t\tif (result.errors.length) {\n\t\t\t\t\tconsole.error(stats.toString({ colors: true }));\n\t\t\t\t\treject(new Error(`Encountered errors while building app`));\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tfulfil(result);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\twatch(cb: (err?: Error, stats?: any) => void) {\n\t\tthis._.watch({}, (err?: Error, stats?: any) => {\n\t\t\tcb(err, stats && new WebpackResult(stats));\n\t\t});\n\t}\n}","import * as path from 'path';\nimport RollupCompiler from './RollupCompiler';\nimport { WebpackCompiler } from './WebpackCompiler';\nimport { set_dev, set_src, set_dest } from '../../config/env';\n\nexport type Compiler = RollupCompiler | WebpackCompiler;\n\nexport type Compilers = {\n\tclient: Compiler;\n\tserver: Compiler;\n\tserviceworker?: Compiler;\n}\n\nexport default async function create_compilers(\n\tbundler: 'rollup' | 'webpack',\n\tcwd: string,\n\tsrc: string,\n\tdest: string,\n\tdev: boolean\n): Promise<Compilers> {\n\tset_dev(dev);\n\tset_src(src);\n\tset_dest(dest);\n\n\tif (bundler === 'rollup') {\n\t\tconst config = await RollupCompiler.load_config(cwd);\n\t\tvalidate_config(config, 'rollup');\n\n\t\tnormalize_rollup_config(config.client);\n\t\tnormalize_rollup_config(config.server);\n\n\t\tif (config.serviceworker) {\n\t\t\tnormalize_rollup_config(config.serviceworker);\n\t\t}\n\n\t\treturn {\n\t\t\tclient: new RollupCompiler(config.client),\n\t\t\tserver: new RollupCompiler(config.server),\n\t\t\tserviceworker: config.serviceworker && new RollupCompiler(config.serviceworker)\n\t\t};\n\t}\n\n\tif (bundler === 'webpack') {\n\t\tconst config = require(path.resolve(cwd, 'webpack.config.js'));\n\t\tvalidate_config(config, 'webpack');\n\n\t\treturn {\n\t\t\tclient: new WebpackCompiler(config.client),\n\t\t\tserver: new WebpackCompiler(config.server),\n\t\t\tserviceworker: config.serviceworker && new WebpackCompiler(config.serviceworker)\n\t\t};\n\t}\n\n\t// this shouldn't be possible...\n\tthrow new Error(`Invalid bundler option '${bundler}'`);\n}\n\nfunction validate_config(config: any, bundler: 'rollup' | 'webpack') {\n\tif (!config.client || !config.server) {\n\t\tthrow new Error(`${bundler}.config.js must export a { client, server, serviceworker? } object`);\n\t}\n}\n\nfunction normalize_rollup_config(config: any) {\n\tif (typeof config.input === 'string') {\n\t\tconfig.input = path.normalize(config.input);\n\t} else {\n\t\tfor (const name in config.input) {\n\t\t\tconfig.input[name] = path.normalize(config.input[name]);\n\t\t}\n\t}\n}\n","import * as fs from 'fs';\nimport * as path from 'path';\nimport { Page, PageComponent, ServerRoute, ManifestData } from '../interfaces';\nimport { posixify, reserved_words } from '../utils';\n\nexport default function create_manifest_data(cwd: string): ManifestData {\n\t// TODO remove in a future version\n\tif (!fs.existsSync(cwd)) {\n\t\tthrow new Error(`As of Sapper 0.21, the routes/ directory should become src/routes/`);\n\t}\n\n\tconst components: PageComponent[] = [];\n\tconst pages: Page[] = [];\n\tconst server_routes: ServerRoute[] = [];\n\n\tconst default_layout: PageComponent = {\n\t\tdefault: true,\n\t\tname: '_default_layout',\n\t\tfile: null\n\t};\n\n\tfunction walk(\n\t\tdir: string,\n\t\tparent_segments: Part[][],\n\t\tparent_params: string[],\n\t\tstack: Array<{\n\t\t\tcomponent: PageComponent,\n\t\t\tparams: string[]\n\t\t}>\n\t) {\n\t\tconst items = fs.readdirSync(dir)\n\t\t\t.map(basename => {\n\t\t\t\tconst resolved = path.join(dir, basename);\n\t\t\t\tconst file = path.relative(cwd, resolved);\n\t\t\t\tconst is_dir = fs.statSync(resolved).isDirectory();\n\n\t\t\t\tconst ext = path.extname(basename);\n\t\t\t\tif (!is_dir && !/^\\.[a-z]+$/i.test(ext)) return null; // filter out tmp files etc\n\n\t\t\t\tconst segment = is_dir\n\t\t\t\t\t? basename\n\t\t\t\t\t: basename.slice(0, -path.extname(basename).length);\n\n\t\t\t\tconst parts = get_parts(segment);\n\t\t\t\tconst is_index = is_dir ? false : basename.startsWith('index.');\n\t\t\t\tconst is_page = ext === '.html';\n\n\t\t\t\tparts.forEach(part => {\n\t\t\t\t\tif (/\\]\\[/.test(part.content)) {\n\t\t\t\t\t\tthrow new Error(`Invalid route ${file} — parameters must be separated`);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (part.qualifier && /[\\(\\)\\?\\:]/.test(part.qualifier.slice(1, -1))) {\n\t\t\t\t\t\tthrow new Error(`Invalid route ${file} — cannot use (, ), ? or : in route qualifiers`);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tbasename,\n\t\t\t\t\tparts,\n\t\t\t\t\tfile: posixify(file),\n\t\t\t\t\tis_dir,\n\t\t\t\t\tis_index,\n\t\t\t\t\tis_page\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter(Boolean)\n\t\t\t.sort(comparator);\n\n\t\titems.forEach(item => {\n\t\t\tif (item.basename[0] === '_') return;\n\n\t\t\tif (item.basename[0] === '.') {\n\t\t\t\tif (item.file !== '.well-known') return;\n\t\t\t}\n\n\t\t\tconst segments = parent_segments.slice();\n\n\t\t\tif (item.is_index && segments.length > 0) {\n\t\t\t\tconst last_segment = segments[segments.length - 1].slice();\n\t\t\t\tconst suffix = item.basename\n\t\t\t\t\t.slice(0, -path.extname(item.basename).length).\n\t\t\t\t\treplace('index', '');\n\n\t\t\t\tif (suffix) {\n\t\t\t\t\tconst last_part = last_segment[last_segment.length - 1];\n\t\t\t\t\tif (last_part.dynamic) {\n\t\t\t\t\t\tlast_segment.push({ dynamic: false, content: suffix });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlast_segment[last_segment.length - 1] = {\n\t\t\t\t\t\t\tdynamic: false,\n\t\t\t\t\t\t\tcontent: `${last_part.content}${suffix}`\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tsegments[segments.length - 1] = last_segment;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsegments.push(item.parts);\n\t\t\t}\n\n\t\t\tconst params = parent_params.slice();\n\t\t\tparams.push(...item.parts.filter(p => p.dynamic).map(p => p.content));\n\n\t\t\tif (item.is_dir) {\n\t\t\t\tconst index = path.join(dir, item.basename, '_layout.html');\n\n\t\t\t\tconst component = fs.existsSync(index) && {\n\t\t\t\t\tname: `${get_slug(item.file)}__layout`,\n\t\t\t\t\tfile: `${item.file}/_layout.html`\n\t\t\t\t};\n\n\t\t\t\tif (component) components.push(component);\n\n\t\t\t\twalk(\n\t\t\t\t\tpath.join(dir, item.basename),\n\t\t\t\t\tsegments,\n\t\t\t\t\tparams,\n\t\t\t\t\tcomponent\n\t\t\t\t\t\t? stack.concat({ component, params })\n\t\t\t\t\t\t: stack.concat(null)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\telse if (item.is_page) {\n\t\t\t\tconst component = {\n\t\t\t\t\tname: get_slug(item.file),\n\t\t\t\t\tfile: item.file\n\t\t\t\t};\n\n\t\t\t\tconst parts = stack.concat({\n\t\t\t\t\tcomponent,\n\t\t\t\t\tparams\n\t\t\t\t});\n\n\t\t\t\tcomponents.push(component);\n\t\t\t\tif (item.basename === 'index.html') {\n\t\t\t\t\tpages.push({\n\t\t\t\t\t\tpattern: get_pattern(parent_segments, true),\n\t\t\t\t\t\tparts\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tpages.push({\n\t\t\t\t\t\tpattern: get_pattern(segments, true),\n\t\t\t\t\t\tparts\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\tserver_routes.push({\n\t\t\t\t\tname: `route_${get_slug(item.file)}`,\n\t\t\t\t\tpattern: get_pattern(segments, false),\n\t\t\t\t\tfile: item.file,\n\t\t\t\t\tparams: params\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tconst root_file = path.join(cwd, '_layout.html');\n\tconst root = fs.existsSync(root_file)\n\t\t? {\n\t\t\tname: 'main',\n\t\t\tfile: '_layout.html'\n\t\t}\n\t\t: default_layout;\n\n\twalk(cwd, [], [], []);\n\n\t// check for clashes\n\tconst seen_pages: Map<string, Page> = new Map();\n\tpages.forEach(page => {\n\t\tconst pattern = page.pattern.toString();\n\t\tif (seen_pages.has(pattern)) {\n\t\t\tconst file = page.parts.pop().component.file;\n\t\t\tconst other_page = seen_pages.get(pattern);\n\t\t\tconst other_file = other_page.parts.pop().component.file;\n\n\t\t\tthrow new Error(`The ${other_file} and ${file} pages clash`);\n\t\t}\n\n\t\tseen_pages.set(pattern, page);\n\t});\n\n\tconst seen_routes: Map<string, ServerRoute> = new Map();\n\tserver_routes.forEach(route => {\n\t\tconst pattern = route.pattern.toString();\n\t\tif (seen_routes.has(pattern)) {\n\t\t\tconst other_route = seen_routes.get(pattern);\n\t\t\tthrow new Error(`The ${other_route.file} and ${route.file} routes clash`);\n\t\t}\n\n\t\tseen_routes.set(pattern, route);\n\t});\n\n\treturn {\n\t\troot,\n\t\tcomponents,\n\t\tpages,\n\t\tserver_routes\n\t};\n}\n\ntype Part = {\n\tcontent: string;\n\tdynamic: boolean;\n\tqualifier?: string;\n};\n\nfunction comparator(\n\ta: { basename: string, parts: Part[], file: string, is_index: boolean },\n\tb: { basename: string, parts: Part[], file: string, is_index: boolean }\n) {\n\tif (a.is_index !== b.is_index) return a.is_index ? -1 : 1;\n\n\tconst max = Math.max(a.parts.length, b.parts.length);\n\n\tfor (let i = 0; i < max; i += 1) {\n\t\tconst a_sub_part = a.parts[i];\n\t\tconst b_sub_part = b.parts[i];\n\n\t\tif (!a_sub_part) return 1; // b is more specific, so goes first\n\t\tif (!b_sub_part) return -1;\n\n\t\tif (a_sub_part.dynamic !== b_sub_part.dynamic) {\n\t\t\treturn a_sub_part.dynamic ? 1 : -1;\n\t\t}\n\n\t\tif (!a_sub_part.dynamic && a_sub_part.content !== b_sub_part.content) {\n\t\t\treturn (\n\t\t\t\t(b_sub_part.content.length - a_sub_part.content.length) ||\n\t\t\t\t(a_sub_part.content < b_sub_part.content ? -1 : 1)\n\t\t\t);\n\t\t}\n\n\t\t// If both parts dynamic, check for regexp patterns\n\t\tif (a_sub_part.dynamic && b_sub_part.dynamic) {\n\t\t\tconst regexp_pattern = /\\((.*?)\\)/;\n\t\t\tconst a_match = regexp_pattern.exec(a_sub_part.content);\n\t\t\tconst b_match = regexp_pattern.exec(b_sub_part.content);\n\n\t\t\tif (!a_match && b_match) {\n\t\t\t\treturn 1; // No regexp, so less specific than b\n\t\t\t}\n\t\t\tif (!b_match && a_match) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a_match && b_match && a_match[1] !== b_match[1]) {\n\t\t\t\treturn b_match[1].length - a_match[1].length;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction get_parts(part: string): Part[] {\n\treturn part.split(/\\[(.+)\\]/)\n\t\t.map((str, i) => {\n\t\t\tif (!str) return null;\n\t\t\tconst dynamic = i % 2 === 1;\n\n\t\t\tconst [, content, qualifier] = dynamic\n\t\t\t\t? /([^(]+)(\\(.+\\))?$/.exec(str)\n\t\t\t\t: [, str, null];\n\n\t\t\treturn {\n\t\t\t\tcontent,\n\t\t\t\tdynamic,\n\t\t\t\tqualifier\n\t\t\t};\n\t\t})\n\t\t.filter(Boolean);\n}\n\nfunction get_slug(file: string) {\n\tlet name = file\n\t\t.replace(/[\\\\\\/]index/, '')\n\t\t.replace(/_default([\\/\\\\index])?\\.html$/, 'index')\n\t\t.replace(/[\\/\\\\]/g, '_')\n\t\t.replace(/\\.\\w+$/, '')\n\t\t.replace(/\\[([^(]+)(?:\\([^(]+\\))?\\]/, '$$$1')\n\t\t.replace(/[^a-zA-Z0-9_$]/g, c => {\n\t\t\treturn c === '.' ? '_' : `$${c.charCodeAt(0)}`\n\t\t});\n\n\tif (reserved_words.has(name)) name += '_';\n\treturn name;\n}\n\nfunction get_pattern(segments: Part[][], add_trailing_slash: boolean) {\n\treturn new RegExp(\n\t\t`^` +\n\t\tsegments.map(segment => {\n\t\t\treturn '\\\\/' + segment.map(part => {\n\t\t\t\treturn part.dynamic\n\t\t\t\t\t? part.qualifier || '([^\\\\/]+?)'\n\t\t\t\t\t: encodeURI(part.content.normalize())\n\t\t\t\t\t\t.replace(/\\?/g, '%3F')\n\t\t\t\t\t\t.replace(/#/g, '%23')\n\t\t\t\t\t\t.replace(/%5B/g, '[')\n\t\t\t\t\t\t.replace(/%5D/g, ']');\n\t\t\t}).join('');\n\t\t}).join('') +\n\t\t(add_trailing_slash ? '\\\\\\/?$' : '$')\n\t);\n}"],"names":["fs.existsSync","fs.mkdirSync","path.relative","write_if_changed","walk","stringify","path.resolve","fs.readFileSync","posixify","path","Module","codec.decode","codec.encode","fs.writeFileSync","fs.readdirSync","fs.statSync","colors","left_pad","pb","relative","path.isAbsolute","require$$0","munge_warning_or_error","format_messages","set_dev","set_src","set_dest","path.normalize","path.join","path.extname","reserved_words"],"mappings":"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"}